# 🦅 宝可梦选秀系统管理员全能手册 (Administrator Manual)

本手册专为 **管理员 (Host/Admin)** 设计，旨在帮助您完全掌控选秀流程。我们将详细解释页面上的每一个按钮功能、比赛创建逻辑以及如何组织一场完美的选秀。

---

## 📋 目录 (Table of Contents)

1. [开始之前：核心概念](#1-开始之前核心概念)
2. [管理员登录与仪表盘](#2-管理员登录与仪表盘)
3. [第一步：创建比赛 (详解)](#3-第一步创建比赛-详解)
   - [基础设置](#31-基础设置-basic)
   - [高级过滤 (种族值/属性/世代)](#32-高级过滤-filters)
   - [实时预览池](#33-实时预览池-preview)
4. [第二步：分档与定价 (仅蛇形模式)](#4-第二步分档与定价-仅蛇形模式)
5. [第三步：选手管理与密钥](#5-第三步选手管理与密钥)
6. [第四步：实战！主持选秀](#6-第四步实战主持选秀)
   - [界面概览](#61-界面概览)
   - [控制台功能详解](#62-控制台功能详解)
   - [竞价模式特殊操作](#63-竞价模式特殊操作)
7. [常见问题与故障排除](#7-常见问题与故障排除)

---

## 1. 开始之前：核心概念

在开始之前，请理解本系统的 **角色**：

- **管理员 (You)**: 类似于"房主"或"裁判"。只有您可以创建比赛、设定规则、控制开始/暂停/撤销。
- **选手 (Players)**: 参与者。他们不需要注册账号，只需要您发给他们的 **Login Key (密钥)** 即可由任意设备直接登录。

本系统支持两种核心玩法：

### 🐍 蛇形选秀 (Snake Draft)

像 NBA 选秀一样。1号位先选，然后2、3、4号选，最后一号选完后立即再选一次 (4号->4号)，然后倒序回3、2、1。公平且快速。

- **核心机制**: 每一轮轮到谁，谁就直接从池子里挑一只。
- **定价**: 宝可梦按强度分档（如 Tier 1 = 15G, Tier 2 = 10G），选手需计算余额消费。
- **DP 保护**: 系统会强制阻止导致未来无法填满队伍的选择。

### 🔨 竞价拍卖 (Auction Draft)

每人有初始资金。轮到某人时，他**提名**一只宝可梦，全场开始**竞价**，价高者得。策略性极强。

- **提名**: 每一轮轮到谁，谁就指定一只想卖的宝可梦。提名者自动以底价成为第一出价人。
- **竞价**: 所有人都可出价。
- **结算**: 倒计时结束或管理员手动成交。
- **无流拍**: 最差情况是提名者以底价买走自己提名的怪。

---

## 2. 管理员登录与仪表盘

### 登录

- **页面**: `/admin/login`
- 输入管理员账号密码即可进入。

### 仪表盘 (Dashboard)

登录即进入仪表盘 `/admin/dashboard`。这里是您的指挥中心：

- **状态概览**: 顶部的卡片显示当前系统的总比赛数等统计。
- **比赛列表**: 显示所有您创建的比赛。每个卡片包含：
  - **状态标签**: `PENDING`(待启动)、`ACTIVE`(进行中)、`COMPLETED`(已结束)。
  - **模式标签**: 蛇形 或 竞价。
  - **数据概览**: 玩家人数、卡池大小。
  - **进入**: 点击卡片任意位置进入该比赛的管理详情页。
- **筛选栏**:
  - **状态筛选**: 点击 `进行中` / `待启动` 等标签快速筛选比赛。
  - **搜索框**: 输入比赛名称快速查找。
- **创建按钮**: 顶部右侧点击 **"创建新比赛"** 开始。

---

## 3. 第一步：创建比赛 (详解)

路径: `仪表盘` -> `创建新比赛`

这是一个强大的配置页面，左侧为设置项，右侧为**实时预览**。您所作的任何修改（如调整种族值范围），右侧的宝可梦列表都会实时刷新，所见即所得。

### 3.1 基础设置 (Basic)

| 设置项       | 说明                                                                                                                                                                                | 建议值                     |
| :----------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------- |
| **比赛名称** | 比赛的标题，选手端也会显示。                                                                                                                                                        | 如 "S1 周末友谊赛"         |
| **规则集**   | **核心过滤规则**。<br>• **Reg H**: 禁神兽/幻兽/悖论种/二级神。<br>• **Reg G**: 允许一只一级神 (限制级)。<br>• **Reg F**: 标准排位环境 (含神兽/悖论)。<br>• **None**: 无限制全图鉴。 | **Reg G** (最通用)         |
| **选秀模式** | **SNAKE** (蛇形) 或 **AUCTION** (竞价)。                                                                                                                                            | -                          |
| **初始筹码** | 每位选手开局拥有的金币。                                                                                                                                                            | 蛇形: 100<br>竞价: 100-200 |
| **捕捉上限** | 每人最多能选几只。                                                                                                                                                                  | **6 只**                   |

#### 竞价模式专属设置 (仅当选 Draft Mode = AUCTION 时出现)

- **起拍底价**: 提名的默认价格。建议设为 **1-5**，让市场决定价格。
- **无时间限制 (手动模式)**:
  - **勾选 (推荐)**: 竞拍过程没有自动倒计时，选手可无限思考，状态显示为"等待管理员手动结束"。
  - **操作**: 管理员必须在控制台点击 **"强制成交" (Force Sell)** 按钮来结束每一轮。界面上会显示 "(手动模式)" 提示。
  - **不勾选**: 启用自动倒计时。
- **竞拍倒计时 (秒)**: 生效于未勾选"无时间限制"时。每次有人出价，倒计时会重置为此时间。建议 **20-30秒**。

### 3.2 高级过滤 (Filters)

点击各折叠面板展开详细设置。

#### 📊 种族值区间 (Min - Max)

可以通过拖动滑块或输入数字精确控制卡池强度。

- **BST (总和)**: 最常用的过滤项。例如 `BST < 500` 可举办"宝宝杯"。
- **HP/Atk/Def...**: 可针对某项能力进行限制。例如 `Spe > 130` 筛选高速手。

#### 🎨 属性过滤

- 支持 **多选**。
- **操作逻辑**:
  - 👆 **点击一次 (变蓝)**: `Include` 模式。卡池**只包含**拥有该属性的宝可梦。(例如只选"水"，则只有水系)
  - 👆 **点击两次 (变红)**: `Exclude` 模式。卡池**剔除**拥有该属性的宝可梦。(例如剔除"钢"系)
  - 👆 **点击三次**: 取消选择。

#### 🕰️ 世代过滤

- 想要举办 "Gen 1 复古杯"？选中 `G1` 即可。
- 同样支持点击变红（剔除某世代）。

### 3.3 实时预览池 (Preview)

- 位于页面右侧（移动端为下方）。
- **搜索测试**: 这里的输入框支持 **PS 搜索语法**，可用于测试您的筛选条件是否正确。
  - `type:fire` (搜索火系)
  - `bst>600` (搜索准神以上)
  - `atk<100, spe>100` (组合搜索)
- **点击图标**: 鼠标悬停在图标上可查看详细种族值。

👉 **全部配置完成后，点击顶部或底部的 "提交并生成比赛" 按钮。**

---

## 4. 第二步：分档与定价 (仅蛇形模式)

> ⚠️ **如果是竞价 (AUCTION) 模式，请跳过此步，直接进入第三步。**

蛇形模式下，创建比赛后会自动跳转到 **价格分档设置 (Price Tiers)** 页面。您必须将宝可梦分配到不同的价格档位，比赛才能开始。

### 界面操作

1.  **左侧未分配池**: 显示所有还未定价的宝可梦。可以使用上方搜索框筛选（如输入 "type:water" 筛选水系）。
2.  **创建档位**: 点击底部的 **"添加新的价格分级"**。会生成一个新的列（如 Tier 1）。
3.  **设定价格**: 在分级名称旁的输入框输入价格（如 20）。
4.  **分配宝可梦 (拖拽/批量)**:
    - **拖拽**: 将左侧的宝可梦拖入右侧档位。
    - **一键导入**: 筛选左侧列表后（如筛选出了所有神兽），点击某档位的 **"一键导入剩余"**，可将当前筛选出的所有怪直接塞入该档。
5.  **删除/调整**:
    - **拖拽**: 右侧档位内的宝可梦可随时拖回左侧，或拖入其他档位。
    - **移除 (X)**: 鼠标悬停在档位中的宝可梦上，点击右上角的红色 **"X"** 按钮，可快速将其移除回未分配池。

### ✅ 检查与保存

- **DP 可行性分析**: 页面右上角会显示"每人 Token"。系统会计算并提示：_"当前定价下，选手是否理论上能买齐 6 只？"_ 如果价格过高，会发出警告。
- **保存**: 务必点击 **"保存并返回"**。

---

## 5. 第三步：选手管理与密钥

进入比赛详情页 (`/admin/contests/[id]`)。点击顶部的 **"生成选手密钥"**。

### 密钥管理流程

1.  **设置人数**: 输入参赛人数（例如 8 人）。
2.  **生成**: 点击 "生成密钥" (或重新生成)。⚠️ **警告**: 重新生成会由系统随机生成新的 Key，旧的 Key 会立即失效，且会**清空当前已存在的选手数据**。请勿在比赛中途操作！
3.  **分发**:
    - 点击 **"复制"** 按钮，将 Key 发给对应选手。
    - 或点击 **"下载 CSV"** 导出表格。
4.  **预设昵称 (可选)**: 您可以点击列表中的铅笔图标，帮选手预先填好 ID（如 "选手A - 小明"），这样他们登录时就不用自己填了。

---

## 6. 第四步：实战！主持选秀

所有选手就位（状态变为绿色）后，在详情页点击 **"启动选秀" (Start Draft)**。
启动后，请点击 **"选秀进行中 - 点击观战"** 进入 **管理员控制台**。

### 6.1 界面概览

管理员控制台 (`/spectate`) 是您的上帝视角：

- **左侧 (选手榜)**: 显示所有选手的状态、当前阵容、剩余代币。
  - **高亮**: 当前正在操作的选手会高亮显示。
  - **掉线检测**: 名字变灰表示离线。
- **中央 (卡池)**: 显示当前剩余的可选宝可梦。
  - **竞价面板**: 竞价模式下，这里会显示当前正在拍卖的宝可梦大图、最高出价即时信息。
- **右侧 (历史)**: 滚动的实时日志，记录每一笔出价、成交。
- **顶部 (控制栏)**: **这是最重要的区域**。

### 6.2 控制台功能详解 (顶部按钮)

| 按钮                 | 功能                                                                                                                    | 使用场景                                            |
| :------------------- | :---------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------- |
| **⏸️ 暂停 (Pause)**  | 冻结比赛。停止所有倒计时，禁止选手操作。                                                                                | 选手掉线、需要上厕所、发生争议。                    |
| **▶️ 继续 (Resume)** | 恢复比赛。                                                                                                              | 争议解决，准备继续。                                |
| **↩️ 撤销 (Undo)**   | **时光倒流**。撤回上一次成交：<br>1. 宝可梦回池<br>2. 钱退回给选手<br>3. 顺位回到那个人/竞价状态重置<br>4. 自动暂停比赛 | 选手手滑点错、系统误判、恶意出价。                  |
| **⏭️ 跳过 (Skip)**   | 强制跳过当前回合选手。                                                                                                  | 轮到某人选人/提名，但他睡着了或失联了，且不想等待。 |

### 6.3 竞价模式特殊操作

如果比赛设置为 "Auction" 模式：

#### 强制成交 (Force Sell / Finalize)

- **出现时机**: A. 开启了"无时间限制"模式； B. 倒计时期间。
- **作用**: 立即以当前最高价成交。
- **无时限模式**: 必须由管理员点击此按钮才会结束当前拍卖，进入下一人。
- **有时限模式**: 倒计时归零会自动成交，但管理员也可点击此按钮提前结束。

#### 修正价格

如果出价出现异常，管理员可以使用 **撤销 (Undo)** 回退到拍卖开始前，要求重新拍卖。

---

## 7. 常见问题与故障排除

### Q: 选手说卡住了/没反应？

- **刷新**: 让选手按 `F5` 刷新。系统是状态驱动的，刷新能解决 99% 的显示不同步问题。
- **检查暂停**: 看看顶栏是不是显示 "PAUSED"？如果是，点 "Resume"。

### Q: 如何修改竞拍底价？

在比赛**未开始**时的详情页可以修改。一旦开始，底价固定。

### Q: 搜索不到某个怪？

1.  **检查规则集**: 是不是开了 Reg H 但在搜一级神（如固拉多）？
2.  **检查形态**: 本系统自动合并了战斗形态（如 Mega、极巨化），只显示基础形态。
3.  **检查过滤器**: 确认没有开启什么特殊的属性过滤。

### Q: 选手点错了怎么办？

不要慌，点击顶部的 **↩️ 撤销 (Undo)**。这是管理员的后悔药，可以无限撤销，直到回到正确的状态。撤销后比赛会自动暂停，确认无误后点击继续即可。

### Q: 比赛结束后如何分享结果？

比赛状态变为 `COMPLETED` 后，回到比赛详情页。会有一个 **"导出结果图片"** 的按钮，点击可生成一张包含所有选手阵容的长图，方便发群里装逼。

---

祝您举办一场精彩的宝可梦选秀！🏆
